<!DOCTYPE html>
<html>
<head>
  <title>خريطة رام الله - توزيع الطبقات</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-geosearch@3.11.0/dist/geosearch.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.css" />

  <style>
    body, html { margin: 0; padding: 0; height: 100%; }
    #map { width: 100%; height: 100%; }
    .topbar {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
      background: white;
      padding: 10px 15px;
      border-radius: 10px;
      font-family: Arial, sans-serif;
      font-size: 16px;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
      direction: rtl;
    }
    .legend {
      background: white;
      padding: 10px;
      font-size: 14px;
      line-height: 1.6em;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.2);
      direction: rtl;
    }
    .legend i {
      width: 20px;
      height: 20px;
      float: right;
      margin-left: 8px;
      opacity: 0.8;
    }
  </style>
</head>
<body>

<div class="topbar">خريطة توزيع الطبقات في مدينة رام الله</div>
<div id="map"></div>

<!-- مكتبات Leaflet -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-geosearch@3.11.0/dist/bundle.min.js"></script>
<script src="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.js"></script>

<script>
  var map = L.map('map').setView([31.9, 35.2], 13);

  // طبقة الخلفية
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '© OpenStreetMap contributors'
  }).addTo(map);

  // تحميل الطبقات
  function addLayer(file, style) {
    fetch(file)
      .then(res => res.json())
      .then(data => {
        L.geoJSON(data, { style: style }).addTo(map);
      });
  }

  // المباني
  addLayer('buildings.geojson', {
    fillColor: 'rgb(225, 225, 225)',
    color: 'rgb(168, 168, 168)',
    weight: 1,
    fillOpacity: 0.7
  });

  // الشوارع الداخلية
  addLayer('Roads_InSide.json', {
    color: 'rgb(158, 170, 155)',
    weight: 2
  });

  // الشوارع الخارجية
  addLayer('Roads_OutSide.json', {
    color: 'rgb(82, 93, 79)',
    weight: 3
  });

  // مزارع النوباني
  addLayer('mazariAlNubani.geojson', {
    fillColor: 'rgb(0, 0, 0)',
    color: 'rgb(0, 0, 0)',
    weight: 1,
    fillOpacity: 0.7
  });

  // Urban Master Plan
  addLayer('urbanMasterPlan.geojson', {
    fillColor: 'rgb(189, 214, 175)',
    color: 'rgb(189, 214, 175)',
    weight: 1,
    fillOpacity: 0.6
  });

  // الأحواض من 1 إلى 6
  addLayer('zones1to6.geojson', {
    fillColor: 'rgb(143, 188, 112)',
    color: 'rgb(143, 188, 112)',
    weight: 1,
    fillOpacity: 0.6
  });

  // أداة تحديد الموقع
  L.control.locate({
    position: 'topright',
    flyTo: true,
    strings: {
      title: "تحديد موقعي"
    }
  }).addTo(map);

  // أداة البحث
  const search = new window.GeoSearch.GeoSearchControl({
    provider: new window.GeoSearch.OpenStreetMapProvider(),
    style: 'bar',
    showMarker: true,
    autoClose: true,
    retainZoomLevel: false,
    searchLabel: 'ابحث هنا...',
    notFoundMessage: 'العنوان غير موجود',
    keepResult: false
  });
  map.addControl(search);

  // وسيلة الإيضاح
  var legend = L.control({position: 'bottomleft'});
  legend.onAdd = function () {
    var div = L.DomUtil.create('div', 'legend');
    div.innerHTML += '<b>وسيلة الإيضاح</b><br>';
    div.innerHTML += '<i style="background: rgb(225, 225, 225); border:1px solid rgb(168, 168, 168);"></i> المباني<br>';
    div.innerHTML += '<i style="background: rgb(158, 170, 155);"></i> الشوارع الداخلية<br>';
    div.innerHTML += '<i style="background: rgb(82, 93, 79);"></i> الشوارع الخارجية<br>';
    div.innerHTML += '<i style="background: rgb(0, 0, 0);"></i> مزارع النوباني<br>';
    div.innerHTML += '<i style="background: rgb(189, 214, 175);"></i> Urban Master Plan<br>';
    div.innerHTML += '<i style="background: rgb(143, 188, 112);"></i> الأحواض من 1 إلى 6<br>';
    return div;
  };
  legend.addTo(map);
</script>

</body>
</html>
